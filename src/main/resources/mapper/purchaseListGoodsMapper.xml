<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.atguigu.jxc.dao.PurchaseListGoodsDao">

    <insert id="saveListGoods" useGeneratedKeys="true" keyProperty="purchaseListGoodsId" parameterType="com.atguigu.jxc.entity.PurchaseListGoods">
        insert into
            t_purchase_list_goods(goods_id,goods_code,goods_name,goods_model,goods_unit,goods_num,total,purchase_list_id,goods_type_id,price)
        values (#{goodsId},#{goodsCode},#{goodsName},#{goodsModel},
                #{goodsUnit},#{goodsNum},#{total},#{purchaseListId}
                ,#{goodsTypeId},#{price})
    </insert>

    <update id="updateState">
        update t_purchase_list set state = 1 where purchase_list_id = #{purchaseListId}
    </update>

    <select id="queryBy"  resultType="com.atguigu.jxc.entity.PurchaseList">
        select t1.`purchase_list_id` purchaseListId,t1.`purchase_number` purchaseNumber,t1.`amount_paid` amountPaid,t1.`amount_payable` amountPayable,t1.`purchase_date` purchaseDate,t1.`remarks`,
               t1.`state`,t1.`supplier_id` supplierId,t1.`user_id` userId,
               t3.`supplier_name` supplierName,t4.`true_name` trueName
        from
        t_purchase_list t1 left join t_purchase_list_goods t2
        on t1.`purchase_list_id` = t2.`purchase_list_id`
        left join t_supplier t3
        on t1.`supplier_id` = t3.`supplier_id`
        left join t_user t4
        on t1.`user_id` = t4.`user_id`
        <where>
            <if test="purchaseNumber != null">
                t1.`purchase_number` like CONCAT('%', #{purchaseNumber} ,'%')
            </if>
            <if test="supplierId != null">
                and t3.`supplier_id` like CONCAT('%', #{supplierId} ,'%')
            </if>
            <if test="state != null">
                and t1.`state` = state
            </if>
            <if test="sTime != null">
                and t1.`purchase_date` &gt;= #{sTime}
            </if>
            <if test="eTime != null">
                and t1.`purchase_date` &lt;= #{eTime}
            </if>
        </where>
    </select>
    <select id="count" resultType="com.atguigu.jxc.domain.CountVo">
        select t1.`purchase_number` number,t1.`purchase_date` `date`,
               t3.`supplier_name` supplierName,t2.`goods_code` code,t2.`goods_name` name,
               t2.`goods_model` model,t4.`goods_type_name` goodsType,t2.`goods_unit` unit,
               t2.`price`,t2.`goods_num` num,t2.`total`
        from t_purchase_list t1
        left join t_purchase_list_goods t2
             on t1.`purchase_list_id` = t2.`purchase_list_id`
        left join t_supplier t3
             on t1.`supplier_id` = t3.`supplier_id`
        left join t_goods_type t4
             on t2.`goods_type_id` = t4.`goods_type_id`
        <where>
            <if test="goodsTypeId != null">
                t4.`goods_type_id` like CONCAT('%', #{goodsTypeId} ,'%')
            </if>
            <if test="codeOrName != null">
                and t2.`goods_code` like CONCAT('%', #{codeOrName} ,'%')
                or t2.`goods_name` like CONCAT('%', #{codeOrName} ,'%')
            </if>
            <if test="sTime != null">
                and t1.`purchase_date` &gt;= #{sTime}
            </if>
            <if test="eTime != null">
                and t1.`purchase_date` &lt;= #{eTime}
            </if>
        </where>
    </select>
</mapper>